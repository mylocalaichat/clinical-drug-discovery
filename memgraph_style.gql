// A palette of colors used to color distinct node labels
Define(COLOR_PALETTE, AsArray(
  #DD2222, #FB6E00, #FFC500, #720096,
  #5E4FA2, #3288BD, #66C2A5, #ABDDA4,
  #E6F598, #FEE08B, #D53E4F, #9E0142
))
Define(COLOR_PALETTE_ITER, AsIterator(COLOR_PALETTE))

// If there are no palette colors to use, use random colors instead
Define(RandomColor, Function(RGB(RandomInt(255), RandomInt(255), RandomInt(255))))
Define(GetNextColor, Function(
  Coalesce(Next(COLOR_PALETTE_ITER), RandomColor())
))

// Cache map to keep a selected color for each node label
Define(ColorByLabel, AsMap())
Define(GetColorByLabel, Function(labels, Coalesce(
  Get(ColorByLabel, labels),
  Set(ColorByLabel, labels, GetNextColor())
)))
Define(JoinLabels, Function(labels, Join(Sort(labels), ":")))

// Baseline node style that will be applied to every single node
@NodeStyle {
  Define(COLOR, GetColorByLabel(JoinLabels(Labels(node))))

  size: 6
  color: COLOR
  color-hover: Lighter(COLOR)
  color-selected: Darker(COLOR)
  border-width: 0.6
  border-color: #1D1D1D
  font-size: 3
  font-color: #1D1D1D
}

// Specific colors for clinical drug discovery node types
@NodeStyle Property(node, "node_type") == "drug" {
  color: #FF6B6B
  color-hover: #FF5252
  color-selected: #E53935
  size: 8
  label: Coalesce(AsText(Property(node, "node_name")), AsText(Property(node, "name")), "Drug")
}

@NodeStyle Property(node, "node_type") == "disease" {
  color: #4ECDC4
  color-hover: #26C6DA
  color-selected: #00ACC1
  size: 8
  label: Coalesce(AsText(Property(node, "node_name")), AsText(Property(node, "name")), "Disease")
}

@NodeStyle Property(node, "node_type") == "pathway" {
  color: #45B7D1
  color-hover: #42A5F5
  color-selected: #1E88E5
  size: 8
  label: Coalesce(AsText(Property(node, "node_name")), AsText(Property(node, "name")), "Pathway")
}

@NodeStyle Property(node, "node_type") == "gene" {
  color: #96CEB4
  color-hover: #81C784
  color-selected: #66BB6A
  size: 8
  label: Coalesce(AsText(Property(node, "node_name")), AsText(Property(node, "name")), "Gene")
}

@NodeStyle Property(node, "node_type") == "protein" {
  color: #A29BFE
  color-hover: #9C88FF
  color-selected: #7C4DFF
  size: 8
  label: Coalesce(AsText(Property(node, "node_name")), AsText(Property(node, "name")), "Protein")
}

// Overwrite node text with the node label if defined
@NodeStyle Greater(Size(Labels(node)), 0) {
  label: Format(":{}", Join(Labels(node), " :"))
}

// Overwrite node text with the property "name" if defined
@NodeStyle HasProperty(node, "name") {
  label: AsText(Property(node, "name"))
}

// Overwrite node text with the property "node_name" if defined (higher priority)
@NodeStyle HasProperty(node, "node_name") {
  label: AsText(Property(node, "node_name"))
}

Define(LATITUDE_FIELD, "lat")
Define(LONGITUDE_FIELD, "lng")

// In the case of numeric latitude and longitude properties, set them up for a switch to a map view
@NodeStyle And(IsNumber(Property(node, LATITUDE_FIELD)), IsNumber(Property(node, LONGITUDE_FIELD))) {
  latitude: Property(node, LATITUDE_FIELD)
  longitude: Property(node, LONGITUDE_FIELD)
}

// Baseline edge style that will be applied to every single edge
@EdgeStyle {
  color: #999999
  color-hover: #1D1D1D
  color-selected: #1D1D1D
  width: 0.3
  width-hover: 0.9
  width-selected: 0.9
  font-size: 3
  font-color: #1D1D1D
}

// Show edge text only if there is a small number of edges in the view
@EdgeStyle Less(EdgeCount(graph), 30) {
  label: Type(edge)
}

// Enhanced edge styles for relationship types
@EdgeStyle Type(edge) == "TREATS" {
  color: #FF6B6B
  width: 0.5
}

@EdgeStyle Type(edge) == "CAUSES" {
  color: #E74C3C
  width: 0.5
}

@EdgeStyle Type(edge) == "INTERACTS_WITH" {
  color: #3498DB
  width: 0.4
}

@EdgeStyle Type(edge) == "REGULATES" {
  color: #9B59B6
  width: 0.4
}

@EdgeStyle Type(edge) == "PARTICIPATES_IN" {
  color: #2ECC71
  width: 0.4
}

// Default view styles
@ViewStyle {
  view: "default"
  background-color: #FFFFFF00
  map-tile-layer: "light"
}